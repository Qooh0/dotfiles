# dotfiles 使い方ガイド

自分用リファレンス。AI 開発ワークフローを中心にまとめる。

---

## 1. クイックリファレンス

### tmux キーバインド（prefix = C-t）

| キー | 動作 |
|------|------|
| `C-t A` | AI開発レイアウト（左60%エディタ + 右上Claude + 右下ターミナル） |
| `C-t D` | デュアルAIレイアウト（Claude vs Aider 比較用） |
| `C-t V` | レビューレイアウト（コード70% + AI 30%） |
| `C-t C` | ペイン内容をクリップボードへキャプチャ（直近3000行） |
| `C-t W` | Worktree + tmuxセッション作成（ブランチ名を入力） |
| `C-t R` | ペイン録画開始/停止（~/.tmux/recordings/に保存） |
| `C-t \|` | 縦分割 |
| `C-t -` | 横分割 |
| `C-t z` | ペインのズーム/解除 |
| `C-t h/j/k/l` | ペイン移動（Vim風） |
| `C-t H/J/K/L` | ペインサイズ変更 |
| `C-t y` | 同期入力の切替（複数ペインに同時入力） |
| `C-t r` | 設定リロード |
| `C-t q` | ペイン番号表示 |

### AI ツールエイリアス

| コマンド | 説明 |
|----------|------|
| `cc` | Claude Code 起動 |
| `ccc` | Claude Code（会話を継続） |
| `ccr` | Claude Code（セッションを再開） |
| `ai` | Aider + Claude Sonnet 4（コスパ最強） |
| `aio` | Aider + Claude Opus 4（最高性能） |
| `aia` | Aider 質問モード（コード変更なし） |
| `ais` | fzf でAIツール選択メニュー |

### Git エイリアス

| コマンド | 説明 |
|----------|------|
| `g s` | git status |
| `g d` / `g dc` | diff / diff --cached |
| `g ci` / `g cia` | commit -v / commit --amend |
| `g cob <branch>` | checkout -b（新ブランチ作成） |
| `g tr` | ツリーグラフ表示 |
| `g la` | ざっくりログ |

### Git Worktree

| コマンド | 説明 |
|----------|------|
| `g wt` | worktree |
| `g wtl` | worktree list |
| `g wta` | worktree add |
| `g wtr` | worktree remove |
| `g wtb <branch>` | 新worktreeをブランチ名で作成（../repo-branch に配置） |
| `wtcd` | fzf で worktree 選択・移動 |
| `wtstat` | 全 worktree の状態確認 |

### AI 開発支援コマンド

| コマンド | 説明 |
|----------|------|
| `ai_workflow` | 3ステップワークフローのリマインダー表示 |
| `tree_ai [depth]` | AIに渡しやすいファイルツリー出力（デフォルト深さ3） |
| `cat_ai file1 file2...` | 複数ファイルをAI向けに出力 |
| `git_summary_ai` | Git状態サマリー（status + log + staged） |
| `cclog` | ログ付きClaude起動（~/.claude/logs/に保存） |
| `claude-md` | ./CLAUDE.md をエディタで開く |

### Git AI エイリアス

| コマンド | 説明 |
|----------|------|
| `g diff-ai` | コンテキスト多めのdiff（色なし、-U10） |
| `g changed-files` | 変更ファイル一覧 |
| `g show-ai` | 最新コミットをAI向けに表示 |

### 便利コマンド

| コマンド | 説明 |
|----------|------|
| `cdr` | Git リポジトリのルートへ移動 |
| `gdai` / `gdsai` | diff を色なしで出力（AI に渡しやすい形式） |
| `gdclip` / `gdsclip` | diff をクリップボードへコピー |
| `clip` | クロスプラットフォーム クリップボード（pbcopy/xclip/clip.exe） |
| `paste` | クロスプラットフォーム ペースト |
| `extract` / `ex` | アーカイブ展開（tar/zip/7z/zst等対応） |

---

## 2. tmux AI 開発レイアウト

### レイアウト A: 標準AI開発（C-t A）

```
+---------------------------+---------------------------+
|                           |     Claude Code (20%)     |
|                           +---------------------------+
|   メインエディタ (60%)     |                           |
|                           |   ターミナル/ログ (20%)    |
+---------------------------+---------------------------+
```

**用途**: 通常の AI 支援開発。左でコード、右上で Claude に質問、右下でテスト/ビルド実行。

### レイアウト D: デュアルAI（C-t D）

```
+---------------------------+---------------------------+
|                           |                           |
|   エディタ (25%)          |   Aider (25%)             |
|                           |                           |
+---------------------------+---------------------------+
|                           |                           |
|   Claude Code (25%)       |   ターミナル (25%)        |
|                           |                           |
+---------------------------+---------------------------+
```

**用途**: Claude と Aider の出力を比較したい時。複雑な問題で複数のアプローチを試す。

### レイアウト V: レビュー（C-t V）

```
+-----------------------------------------------+---------------+
|                                               |               |
|          コード/diff 表示 (70%)               |   AI (30%)    |
|                                               |               |
+-----------------------------------------------+---------------+
```

**用途**: コードレビュー。diff を大きく表示しながら AI に解説してもらう。

---

## 3. Claude Code と Aider の使い分け

### Claude Code を使う場面

- **複雑なコードベース理解**: ファイル横断的な調査
- **大規模リファクタリング**: 複数ファイルにまたがる変更
- **会話継続が重要な時**: `ccc` で前回のコンテキストを引き継ぐ
- **MCP 統合**: 外部ツール連携が必要な時

### Aider を使う場面

- **単一ファイルの編集**: 集中的なコード修正
- **Git 統合が便利**: 自動コミット機能
- **コスト最適化**: Sonnet 4 (`ai`) で十分な場合が多い
- **質問のみ**: `aia` でコード変更せずに質問

### 使い分けフロー

```
問題が明確？
├── Yes → 変更箇所が1-2ファイル？
│         ├── Yes → Aider (`ai`)
│         └── No  → Claude Code (`cc`)
└── No  → 調査が必要？
          ├── Yes → Claude Code (`cc`) で Research
          └── No  → Aider ask mode (`aia`) で質問
```

---

## 4. Git Worktree を使った並行開発

### 基本的な考え方

Worktree = 同じ .git を共有する別の作業ディレクトリ。ブランチを切り替えずに複数タスクを並行できる。

### 典型的なワークフロー

```bash
# 1. 新機能用の worktree を作成
g wtb feature/new-login
# → ../project-feature/new-login に作成される

# 2. そこに移動
wtcd  # fzf で選択

# 3. 作業終了後、削除
g wtr ../project-feature/new-login
g wtp  # 参照切れをクリーンアップ
```

### AI 並行開発パターン

```bash
# ターミナル1: メイン作業
cd ~/project
tmux new -s main
cc  # Claude Code でメイン機能開発

# ターミナル2: バグ修正（別 worktree）
cd ~/project
g wtb fix/urgent-bug
wtcd  # fix/urgent-bug を選択
tmux new -s bugfix
ai  # Aider で素早くバグ修正
```

### 全 worktree の状態確認

```bash
wtstat
# 各 worktree の未コミット変更を一覧表示
```

---

## 5. 実践ワークフロー

### パターン A: 新機能開発

```bash
# 1. セッション開始
tm  # または tmux new -s feature-name

# 2. AI 開発レイアウトに切替
# C-t A

# 3. 左ペイン: エディタ開く
vim .

# 4. 右上ペイン: Claude で調査（Research フェーズ）
cc
> このプロジェクトの認証システムについて教えて。コードは書かなくていい。

# 5. 計画を立てる（Plan フェーズ）
> 新しいログイン機能を実装する計画を立てて。ステップバイステップで。

# 6. 実装（Implement フェーズ）
> 計画に従って実装を開始して。

# 7. テスト実行（右下ペイン）
npm test

# 8. コミット
g ci
```

### パターン B: バグ修正

```bash
# 1. 問題の調査
ccc  # 直前の会話を継続
> エラーログを見て。[ログをペースト]

# 2. 修正案の確認
aia  # コード変更なしで質問
> この修正案で問題ないか確認して

# 3. 修正を適用
ai
> 確認した修正を適用して

# 4. テスト
npm test
```

### パターン C: 複数タスクの並行作業

```bash
# Worktree 1: メイン機能（Claude Code）
g wtb feature/main
wtcd
C-t A
cc

# Worktree 2: リファクタリング（Aider）
# 別ターミナルで
g wtb refactor/cleanup
wtcd
ai

# 両方の状態確認
wtstat
```

---

## 6. 3ステップワークフロー

Anthropic 推奨のベストプラクティス。

### Research（調査）

```
> このプロジェクトの構造を教えて。コードは書かなくていい。
> 認証周りの実装を見せて。
> エラーハンドリングのパターンを調べて。
```

**ポイント**: 「コードは書かなくていい」と明示する。

### Plan（計画）

```
> この機能を実装する計画を立てて。
> ステップバイステップで、どのファイルを変更するか含めて。
> 考えられるリスクや注意点も挙げて。
```

**ポイント**: 実装前に全体像を把握する。

### Implement（実装）

```
> 計画のステップ1を実装して。
> テストも書いて。
> 完了したらステップ2に進んで。
```

**ポイント**: 一度に全部ではなく、段階的に進める。

---

## 7. プロファイル切替

### daily（デフォルト）

```bash
# .zshrc.daily が読み込まれる
# - 履歴共有あり（100,000行）
# - Powerline風プロンプト（Git情報表示）
```

### shoot（撮影用）

```bash
ZSH_PROFILE=shoot zsh
# - 履歴最小（1,000行、保存なし）
# - シンプルなプロンプト
# - 画面録画やデモに最適
```

---

## 8. Tips

### ペイン内容を AI に渡す

```bash
# C-t C でクリップボードにコピー、その後 AI にペースト
# または
gdclip  # git diff をクリップボードへ
```

### コンテキスト共有

```bash
# プロジェクト情報を表示
# ais → context を選択
# または直接
_ai_context
```

### セッション管理

```bash
tm     # tmux new -s kkaieda
tma    # tmux attach -t kkaieda
```

### 履歴検索（fzf）

- `Ctrl+R`: コマンド履歴をfzf検索
- `Ctrl+T`: ファイルをfzf検索してコマンドラインに挿入

---

## 9. Claude Code スラッシュコマンド

private_dotfiles で定義されるカスタムコマンド。

### /review

コードレビューを依頼:

```
/review src/components/Auth.tsx
```

観点:
- バグ・エラー
- セキュリティ
- パフォーマンス
- 可読性
- テストカバレッジ

### /explain

コードの解説を依頼:

```
/explain src/utils/parser.ts
```

出力:
- 何をしているか
- なぜそうしているか
- 使われているパターン

### /test

テスト作成を依頼:

```
/test src/services/api.ts
```

作成されるテスト:
- 正常系
- 異常系・エッジケース
- モック設定

---

## 10. ペイン録画

tmux のペイン録画機能で AI との対話を保存。

### 使い方

```bash
# 録画開始
C-t R  # "Recording started" と表示

# 作業...

# 録画停止
C-t R  # "Recording stopped" と表示
```

### 保存場所

```
~/.tmux/recordings/
├── main-0-0-20241229-143052.log
├── feature-1-0-20241229-150123.log
└── ...
```

ファイル名: `{セッション名}-{ウィンドウ}-{ペイン}-{日時}.log`

### 活用例

- AI との対話を振り返る
- 問題解決の過程を記録
- ペアプログラミングのログ
